#!/usr/bin/env bash

# script for convinient compiling latex and automaticly versioning
# bk - 2025-09-07

if [[ "$1" == "-h" || "$1" == "--help" ]]; then
	printf "%s\n  %s\n  %s\n\n" \
		'Usage:' \
		'lateko - compiles latex in the curent directory and opens preview' \
		'lateko "version name" - compiles and saves this version to the ./versions/"version name"'
	exit 0
fi

if [[ ! -f main.tex ]]; then
	echo "./main.tex does not exist"
	echo "are you sure you are in the latex directory?"
	exit 1
fi

if ! pdflatex main.tex; then
	echo "Compilation failed"
	exit 1
fi

if command -v zathura >/dev/null 2>&1; then
	zathura ./main.pdf &
elif command -v xdg-open >/dev/null 2>&1; then
	xdg-open ./main.pdf &
elif [[ -n "$BROWSER" ]]; then
	"$BROWSER" ./main.pdf &
else
	echo 'No PDF viewer found, tried: zathura, xdg-open, $BROWSER'
fi

if [[ -z "$1" ]]; then
	exit 0
fi

mkdir -p "versions/$1"
cp ./main.pdf "./versions/$1/$1.pdf"
cp ./main.tex "./versions/$1/$1.tex"
